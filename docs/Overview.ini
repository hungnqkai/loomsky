# OVERVIEW
- TÃªn: LoomSky
- Loáº¡i HÃ¬nh: SAAS
- MÃ´ HÃ¬nh Doanh Thu: Freemium
- TÃ­ch há»£p Ä‘a ná»n táº£ng: Wordpress, Shopify, Ná»n táº£ng landingpage html

# Unique Value Proposition
Complete Solution:
âœ“ Journey tracking + A/B testing + CAPI integration
âœ“ Single platform thay vÃ¬ multiple tools
âœ“ Better pricing than enterprise solutions
âœ“ Freemium accessibility

Technical Differentiators:
âœ“ Cross-platform identity resolution
âœ“ Real-time journey stitching
âœ“ WordPress/Shopify/Landingpage deep integration
âœ“ Visual no-code setup
âœ“ Enhanced Facebook attribution

# Data Flow
1. User Visit â†’ Identity Resolution
2. Identity + UTM â†’ Attribution Tracking  
3. Attribution + Session â†’ Event Processing
4. Event + Page â†’ A/B Test Assignment
5. Event + Attribution â†’ Facebook CAPI
6. All Data â†’ Real-time Analytics
7. Analytics â†’ Dashboard Updates

graph TB
    subgraph "Customer Website"
        A[User Visits Website] --> B[Loomsky SDK Loads]
        B --> C[Capture UTM Parameters]
        C --> D[Resolve User Identity]
        D --> E[Start/Continue Session]
        E --> F[Track Page View Event]
    end

    subgraph "Platform Detection"
        F --> G{Platform Type?}
        G -->|WordPress| H[WordPress API Integration]
        G -->|Shopify| I[Shopify Data Enhancement]
        G -->|Generic| J[Generic Tracking]
    end

    subgraph "Identity Resolution Module"
        D --> K{Existing User?}
        K -->|Yes| L[Load User Profile]
        K -->|No| M[Create Anonymous User]
        L --> N[Update Last Seen]
        M --> O[Generate ls_anon_ID]
    end

    subgraph "Attribution Module"
        C --> P[Process UTM Data]
        P --> Q{First Touch?}
        Q -->|Yes| R[Create First Touch Attribution]
        Q -->|No| S[Create Multi-Touch Attribution]
        R --> T[Store Attribution Chain]
        S --> T
    end

    subgraph "A/B Testing Module"
        F --> U{Active A/B Tests?}
        U -->|Yes| V[Check User Assignment]
        U -->|No| W[Continue Normal Flow]
        V --> X{Already Assigned?}
        X -->|Yes| Y[Load Existing Variant]
        X -->|No| Z[Assign New Variant]
        Z --> AA[Apply Variant Changes]
        Y --> AA
    end

    subgraph "Event Processing"
        AA --> BB[Process Event Data]
        BB --> CC[Enrich with Context]
        CC --> DD[Store in Database]
        DD --> EE[Queue Background Jobs]
    end

    subgraph "Facebook CAPI Module"
        EE --> FF{Facebook Integration?}
        FF -->|Yes| GG[Prepare CAPI Event]
        FF -->|No| HH[Skip Facebook]
        GG --> II[Hash User Data]
        II --> JJ[Send to Facebook API]
        JJ --> KK[Log CAPI Response]
    end

    subgraph "Analytics Module"
        DD --> LL[Update Real-time Metrics]
        LL --> MM[Process Journey Data]
        MM --> NN[Calculate Funnel Steps]
        NN --> OO[Update Dashboard]
    end

    subgraph "Database Layer"
        DD --> PP[(Users Table)]
        DD --> QQ[(Events Table)]
        DD --> RR[(Sessions Table)]
        DD --> SS[(Attribution Table)]
        DD --> TT[(A/B Tests Table)]
        KK --> UU[(Facebook Events Table)]
    end

    subgraph "Real-time Updates"
        OO --> VV[WebSocket Emit]
        VV --> WW[Dashboard Update]
        VV --> XX[Live Analytics]
    end

    subgraph "Background Processing"
        EE --> YY[Analytics Queue]
        EE --> ZZ[Facebook Queue]
        EE --> AAA[Email Queue]
        YY --> BBB[Process Daily Reports]
        ZZ --> CCC[Retry Failed Events]
        AAA --> DDD[Send Notifications]
    end
    
# Core Features
1. Core Base
Quáº£n lÃ½ client
Quáº£n lÃ½ user / team
Quáº£n lÃ½ Subscription
JWT: jsonwebtoken + refresh token rotation
Thanh toÃ¡n Paypal
TÃ­ch há»£p i18n Frontend Vue

2. Customer Journey
Real-time user tracking across multiple touchpoints
Visual journey visualization vá»›i funnel analysis (Awareness - Consideration - Decision - Sá»­ dá»¥ng UTM mapping???)
Cross-device journey stitching
Behavioral segmentation vÃ  user profiling
Journey completion rates vÃ  drop-off analysis

3. Dynamic Web Interface Changes (A/B Testing)
Visual element selector (giá»‘ng GTM interface)
Real-time content modification (prices, layouts, content)
Multi-variant testing vá»›i statistical significance
Automated traffic allocation vÃ  winner selection
Conversion rate optimization tools

4. Facebook CAPI Integration
Server-side event tracking bypass iOS 14.5+ limitations
Enhanced attribution vá»›i complete user data
Custom audience building tá»« journey data
ROAS optimization vá»›i A/B test variants
Event deduplication giá»¯a Pixel vÃ  CAPI

# Technology Stack
1. Backend
Core Framework:
â”œâ”€â”€ Node.js vá»›i Express.js
â”œâ”€â”€ Bull Queue cho background processing
â”œâ”€â”€ PostgreSQL + Sequelize ORM
â”œâ”€â”€ Redis cho sessions vÃ  caching
â”œâ”€â”€ Express-session vá»›i Redis store
â””â”€â”€ CORS middleware
Additional Tools:
â”œâ”€â”€ Pm2 
â””â”€â”€ Socket.io cho real-time updates

2. Frontend (Vue.js)
Core Framework:
â”œâ”€â”€ Vue 3 vá»›i Composition API
â”œâ”€â”€ Pinia cho state management
â”œâ”€â”€ Vue Router cho routing
â”œâ”€â”€ Vuetify 3 cho UI components
â”œâ”€â”€ Vue3 ApexCharts cho visualization
â””â”€â”€ SCSS cho styling
Additional Tools:
â”œâ”€â”€ Axios cho HTTP requests
â”œâ”€â”€ Socket.io client cho real-time
â””â”€â”€ Vite cho build tooling

# Database Architecture
Core Tables:
â”œâ”€â”€ users (identity management)
â”œâ”€â”€ clients (customer accounts)
â”œâ”€â”€ events (user interactions)
â”œâ”€â”€ sessions (user sessions)
â”œâ”€â”€ ab_tests (A/B test configs)
â”œâ”€â”€ journeys (customer journeys)
â””â”€â”€ facebook_events (CAPI data)

Optimization:
â”œâ”€â”€ Partitioning by date
â”œâ”€â”€ Strategic indexing
â”œâ”€â”€ Read replicas
â””â”€â”€ Connection pooling

# Backend API Routes
Separate route groups
app.use('/api/v1/customer', customerRoutes);     # app.loomsky.net
app.use('/api/v1/admin', adminAuthMiddleware, adminRoutes);  # admin.loomsky.net

Admin-only endpoints
router.get('/admin/customers', getCustomerList);
router.get('/admin/system/health', getSystemHealth);
router.post('/admin/features/toggle', toggleFeature);

# Project Structure
journey-tracker-saas/
â”œâ”€â”€ backend/                    # Shared API
â”œâ”€â”€ frontend-customer/          # Customer dashboard (app.loomsky.net)
â”œâ”€â”€ frontend-admin/            # Admin panel (admin.loomsky.net)  
â””â”€â”€ sdk/                       # Customer SDK

# Backend Structure (Node.js)
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/                 # Configuration files
â”‚   â”‚   â”œâ”€â”€ database.js
â”‚   â”‚   â”œâ”€â”€ redis.js
â”‚   â”‚   â”œâ”€â”€ facebook.js
â”‚   â”‚   â”œâ”€â”€ environment.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/            # Route controllers
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # Database models (Sequelize)
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                 # API routes
â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # Business logic
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/             # Express middleware
â”‚   â”‚
â”‚   â”œâ”€â”€ jobs/                   # Background jobs (Bull Queue)
â”‚   â”‚   â”œâ”€â”€ processors/
â”‚   â”‚   â”œâ”€â”€ queues/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # Utility functions
â”‚   â”‚
â”‚   â”œâ”€â”€ database/               # Database related
â”‚   â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ seeders/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ websocket/              # Socket.io handlers
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ validators/             # Input validation schemas
â”‚   â”‚
â”‚   â””â”€â”€ app.js                  # Express app setup
â”‚
â”œâ”€â”€ tests/                      # Test files
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ fixtures/
â”‚   â””â”€â”€ setup.js
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ .env
â””â”€â”€ server.js                   # Entry point

# Frontend Structure
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ images/
â”‚       â””â”€â”€ icons/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/             # Reusable components
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ journey/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ abtest/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ integrations/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ forms/
â”‚   â”‚
â”‚   â”œâ”€â”€ views/                  # Page components
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ journey/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ abtest/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ integrations/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ onboarding/
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                 # Pinia stores
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # API services
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                 # Vue Router
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ guards.js
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚
â”‚   â”œâ”€â”€ plugins/                # Vue plugins
â”‚   â”‚   â”œâ”€â”€ vuetify.js
â”‚   â”‚   â”œâ”€â”€ apexcharts.js
â”‚   â”‚   â”œâ”€â”€ i18n.js
â”‚   â”‚   â””â”€â”€ socket.js
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # Utility functions
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                 # Static assets
â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/            # Vue 3 composables
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue                 # Root component
â”‚   â””â”€â”€ main.js                 # Entry point
â”‚
â”œâ”€â”€ tests/                      # Frontend tests
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ e2e/
â”‚   â””â”€â”€ setup.js
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ .env
â””â”€â”€ vitest.config.js

# Admin-specific Structure:
frontend-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ customers/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ system/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ reports/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚
â””â”€â”€ package.json (different dependencies tá»« customer app)

# JavaScript SDK Structure
sdk/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ tracker.js          # Main tracking logic
â”‚   â”‚   â”œâ”€â”€ identity.js         # User identification
â”‚   â”‚   â”œâ”€â”€ session.js          # Session management
â”‚   â”‚   â”œâ”€â”€ storage.js          # Data persistence
â”‚   â”‚   â””â”€â”€ api.js              # API communication
â”‚   â”‚
â”‚   â”œâ”€â”€ platforms/              # Platform-specific integrations
â”‚   â”‚   â”œâ”€â”€ wordpress.js
â”‚   â”‚   â”œâ”€â”€ shopify.js
â”‚   â”‚   â”œâ”€â”€ woocommerce.js
â”‚   â”‚   â””â”€â”€ generic.js
â”‚   â”‚
â”‚   â”œâ”€â”€ events/                 # Event tracking
â”‚   â”‚   â”œâ”€â”€ pageview.js
â”‚   â”‚   â”œâ”€â”€ click.js
â”‚   â”‚   â”œâ”€â”€ form.js
â”‚   â”‚   â”œâ”€â”€ ecommerce.js
â”‚   â”‚   â””â”€â”€ custom.js
â”‚   â”‚
â”‚   â”œâ”€â”€ integrations/           # Third-party integrations
â”‚   â”‚   â”œâ”€â”€ facebook.js
â”‚   â”‚   â”œâ”€â”€ google.js
â”‚   â”‚   â””â”€â”€ gtm.js
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ dom.js
â”‚   â”‚   â”œâ”€â”€ device.js
â”‚   â”‚   â”œâ”€â”€ url.js
â”‚   â”‚   â””â”€â”€ validation.js
â”‚   â”‚
â”‚   â””â”€â”€ index.js                # SDK entry point
â”‚
â”œâ”€â”€ dist/                       # Built SDK files
â”‚   â”œâ”€â”€ journey-tracker.js      # Development version
â”‚   â”œâ”€â”€ journey-tracker.min.js  # Production version
â”‚   â””â”€â”€ journey-tracker.esm.js  # ES Module version
â”‚
â”œâ”€â”€ examples/                   # Usage examples
â”‚   â”œâ”€â”€ basic-setup.html
â”‚   â”œâ”€â”€ wordpress-example.php
â”‚   â”œâ”€â”€ shopify-example.liquid
â”‚   â””â”€â”€ react-example.jsx
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ docs/                       # SDK documentation
â”‚   â”œâ”€â”€ getting-started.md
â”‚   â”œâ”€â”€ api-reference.md
â”‚   â”œâ”€â”€ platform-guides/
â”‚   â””â”€â”€ troubleshooting.md
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ webpack.config.js
â”œâ”€â”€ babel.config.js
â””â”€â”€ .eslintrc.js

# Development Strategy: Complete One Feature Before Next
1. Phase 1: Base core
- Authentication & user management
- Client management system
- Thanh toÃ¡n vÃ  quáº£n lÃ½ gÃ³i Ä‘Äƒng kÃ½
- PayPal Subscription System

2. Phase 2: Customer Journey Tracking
Goal: Perfect customer journey tracking trÆ°á»›c khi build features khÃ¡c
Feature Scope:
âœ… Complete User Identity Resolution System
âœ… UTM Attribution Tracking (Full Multi-touch)
âœ… Customer Journey Visualization
âœ… Real-time Event Tracking
âœ… Platform Integrations (WordPress, Shopify, Generic)
âœ… Analytics Dashboard (Journey-focused)

Technical Deliverables:
Backend (Node.js) - Complete:
â”œâ”€â”€ Identity resolution engine
â”œâ”€â”€ UTM attribution processing
â”œâ”€â”€ Session management
â”œâ”€â”€ Event tracking & storage
â”œâ”€â”€ Journey analytics engine
â”œâ”€â”€ Real-time WebSocket updates
â”œâ”€â”€ Platform-specific integrations
â”œâ”€â”€ Data export functionality
â””â”€â”€ RESTful API (v1 complete)

Frontend (Vue.js) - Complete:
â”œâ”€â”€ Journey visualization dashboard
â”œâ”€â”€ Real-time activity feed
â”œâ”€â”€ Attribution analysis views
â”œâ”€â”€ User segment builder
â”œâ”€â”€ Settings & preferences
â”œâ”€â”€ Data export interface
â””â”€â”€ Mobile-responsive design

JavaScript SDK - Complete:
â”œâ”€â”€ Universal tracking (all platforms)
â”œâ”€â”€ Identity management
â”œâ”€â”€ UTM parameter capture
â”œâ”€â”€ Event auto-detection
â”œâ”€â”€ WordPress deep integration
â”œâ”€â”€ Shopify/WooCommerce support
â”œâ”€â”€ Form tracking automation
â”œâ”€â”€ E-commerce event capture
â”œâ”€â”€ Error handling & retry logic
â””â”€â”€ Performance optimization

3. Phase 3: A/B Testing System
Goal: Complete A/B testing platform before moving to next feature
Feature Scope:
âœ… Visual A/B Test Builder (GTM-style interface)
âœ… Advanced Element Selector
âœ… Variant Management System
âœ… Statistical Significance Engine
âœ… Automated Winner Selection
âœ… Integration vá»›i Journey Data
âœ… Multi-page Test Support
âœ… Advanced Targeting Rules

Technical Deliverables:
Backend A/B Testing - Complete:
â”œâ”€â”€ A/B test configuration API
â”œâ”€â”€ Variant assignment algorithm
â”œâ”€â”€ Statistical analysis engine
â”œâ”€â”€ Conversion tracking system
â”œâ”€â”€ Test results calculations
â”œâ”€â”€ Automated optimization logic
â”œâ”€â”€ Advanced targeting engine
â”œâ”€â”€ Test scheduling system
â”œâ”€â”€ Performance analytics
â””â”€â”€ Integration vá»›i journey data

Frontend A/B Testing - Complete:
â”œâ”€â”€ Visual test builder interface
â”œâ”€â”€ Advanced element selector tool
â”œâ”€â”€ Variant editor vá»›i preview
â”œâ”€â”€ Test configuration wizard
â”œâ”€â”€ Statistical significance dashboard
â”œâ”€â”€ Test results visualization
â”œâ”€â”€ Performance comparison charts
â”œâ”€â”€ Test management interface
â”œâ”€â”€ Advanced targeting UI
â””â”€â”€ Mobile test preview

SDK A/B Testing - Complete:
â”œâ”€â”€ Real-time variant delivery
â”œâ”€â”€ Advanced DOM manipulation
â”œâ”€â”€ Test assignment persistence
â”œâ”€â”€ Conversion goal tracking
â”œâ”€â”€ Performance optimization
â”œâ”€â”€ Multi-page test support
â”œâ”€â”€ Advanced targeting logic
â”œâ”€â”€ Error handling & fallbacks
â”œâ”€â”€ Test debugging tools
â””â”€â”€ Analytics integration

4. Phase 4 - Facebook CAPI Integration
Goal: Perfect Facebook Conversions API integration
Feature Scope:
âœ… Complete Facebook CAPI Integration
âœ… Advanced Attribution Analysis
âœ… Custom Audience Building tá»« Journey Data
âœ… Cross-platform Event Mapping
âœ… Attribution Model Comparison
âœ… Facebook Ads Performance Insights
âœ… Automated Audience Optimization
âœ… Real-time Event Synchronization
Technical Deliverables:
Backend Facebook Integration - Complete:
â”œâ”€â”€ Facebook CAPI service (enterprise-grade)
â”œâ”€â”€ Advanced event mapping system
â”œâ”€â”€ Custom audience creation API
â”œâ”€â”€ Attribution enhancement engine
â”œâ”€â”€ Cross-platform data correlation
â”œâ”€â”€ Facebook webhook handling
â”œâ”€â”€ Event deduplication logic
â”œâ”€â”€ Retry vÃ  error handling
â”œâ”€â”€ Rate limiting management
â””â”€â”€ Performance optimization

Frontend Facebook Features - Complete:
â”œâ”€â”€ Facebook integration setup wizard
â”œâ”€â”€ Advanced attribution dashboards
â”œâ”€â”€ Audience management interface
â”œâ”€â”€ Campaign performance analytics
â”œâ”€â”€ Event mapping configuration
â”œâ”€â”€ Attribution model comparison
â”œâ”€â”€ Facebook-specific insights
â”œâ”€â”€ Audience optimization suggestions
â”œâ”€â”€ Real-time sync monitoring
â””â”€â”€ ROI analysis tools

SDK Facebook Enhancement - Complete:
â”œâ”€â”€ Facebook Pixel integration
â”œâ”€â”€ Enhanced event data collection
â”œâ”€â”€ Server-side event backup
â”œâ”€â”€ Attribution context preservation
â”œâ”€â”€ Event deduplication
â”œâ”€â”€ Privacy-compliant data handling
â”œâ”€â”€ Error recovery mechanisms
â”œâ”€â”€ Performance monitoring
â”œâ”€â”€ Debug mode cho troubleshooting
â””â”€â”€ Advanced event enrichment


## Káº¿ Hoáº¡ch Phase 1 - Base core
Step 1: Foundation Setup (3-5 days)
Backend Foundation:
â”œâ”€â”€ Project structure setupâœ…
â”œâ”€â”€ Database connection (PostgreSQL + Sequelize)âœ…
â”œâ”€â”€ Redis connection âœ…
â”œâ”€â”€ Basic Express app vá»›i CORSâœ…
â”œâ”€â”€ Environment configurationâœ…
â””â”€â”€ Basic error handling middlewareâœ…

Frontend Foundation:
â”œâ”€â”€ Vue 3 + Vite setup (customer & admin)âœ…
â”œâ”€â”€ Vuetify 3 configurationâœ…
â”œâ”€â”€ Router setup vá»›i guardsâœ…
â”œâ”€â”€ Pinia stores structureâœ…
â””â”€â”€ Axios configuration vá»›i interceptorsâœ…
Step 2: Database Schema (2-3 days)
sqlCore Tables:
â”œâ”€â”€ clients (tenant isolation)âœ…
â”œâ”€â”€ users (authentication + profile)âœ…
â”œâ”€â”€ subscriptions (PayPal integration)âœ…
â”œâ”€â”€ payments (transaction history)âœ…
â””â”€â”€ user_sessions (refresh token management)âœ…
Step 3: Authentication System (4-5 days)âœ…
Backend Auth:
â”œâ”€â”€ JWT service (access + refresh tokens)âœ…
â”œâ”€â”€ Password hashing (bcrypt)âœ…
â”œâ”€â”€ Email service (Mailgun setup)âœ…
â”œâ”€â”€ Auth middlewareâœ…
â””â”€â”€ Password reset flowâœ…

Frontend Auth:
â”œâ”€â”€ Auth store (Pinia)âœ…
â”œâ”€â”€ Login/Register formsâœ…
â”œâ”€â”€ Token managementâœ…
â”œâ”€â”€ Route guardsâœ…
â””â”€â”€ Password reset UIâœ…
Step 4: Client Management (3-4 days)
Multi-tenant Setup:
â”œâ”€â”€ Client registration flow
â”œâ”€â”€ Tenant isolation middleware
â”œâ”€â”€ Team invitation system
â”œâ”€â”€ Role-based access control
â””â”€â”€ Client settings management
Step 5: Subscription System (5-7 days)
PayPal Integration:
â”œâ”€â”€ PayPal SDK setupâœ…
â”œâ”€â”€ Subscription plans managementâœ…
â”œâ”€â”€ Recurring payment handlingâœ…
â”œâ”€â”€ One-time payment supportâœ…
â”œâ”€â”€ Upgrade/downgrade logicâœ…
â”œâ”€â”€ Usage tracking foundationâœ…
â””â”€â”€ Billing historyâœ…
Step 6: Admin Panel (2-3 days)
Admin Features:
â”œâ”€â”€ Customer management
â”œâ”€â”€ Subscription overview
â”œâ”€â”€ System health monitoring
â””â”€â”€ Basic analytics
Total Estimate: 19-27 days

Milestone Deliverables:
Working authentication system
âœ… Multi-tenant client management
âœ… PayPal subscription integration
âœ… Admin panel for system management
âœ… Ready for Phase 2 (A/B Testing)


ğŸ“‹ Frontend Development Plan
Phase 1A: Frontend Customer (app.loomsky.net)
    Priority: Core Authentication & Dashboard
Step 1: Authentication Pages (3-4 days)
Pages to Build:
    â”œâ”€â”€ /login âœ… - Login form vá»›i token management            
    â”œâ”€â”€ /register âœ… - Multi-step registration wizard
    â”œâ”€â”€ /verify-email âœ… - Email verification page
    â”œâ”€â”€ /forgot-password âœ… - Password reset request
    â”œâ”€â”€ /reset-password âœ… - Password reset form
    â”œâ”€â”€ /accept-invitation (LÃ m sau) - Team invitation acceptance
    â””â”€â”€ Layout components âœ… (Auth layout)

Step 2: Dashboard Foundation (2-3 days)
Core Dashboard:
    â”œâ”€â”€ /dashboard âœ… - Main dashboard vá»›i basic stats
    â”œâ”€â”€ /profile âœ…- User profile management
    â”œâ”€â”€ /settings  - Account settings
    â”œâ”€â”€ Sidebar navigation âœ…
    â”œâ”€â”€ Header vá»›i user menu âœ…
    â””â”€â”€ Protected route guards âœ…

Step 3: Basic Client Management (2-3 days)
Client Features:
    â”œâ”€â”€ Client settings page
    â”œâ”€â”€ Team management (invite/remove members) âœ…
    â”œâ”€â”€ Billing information display âœ…
    â”œâ”€â”€ Subscription status
    â””â”€â”€ Usage metrics display

Phase 1B: Frontend Admin (admin.loomsky.net)
Priority: System Management

Step 4: Admin Authentication (1-2 days)
Admin Auth:
    â”œâ”€â”€ Admin login (reuse components)
    â”œâ”€â”€ Admin-specific guards
    â””â”€â”€ Admin layout

Step 5: Admin Dashboard (2-3 days)
Admin Features:
    â”œâ”€â”€ System overview dashboard
    â”œâ”€â”€ Customer management (list, view, edit)
    â”œâ”€â”€ Subscription management
    â”œâ”€â”€ System health monitoring
    â””â”€â”€ Basic analytics

ğŸ¯ Technical Implementation Strategy:
Shared Components Library:

components/common/
    â”œâ”€â”€ forms/ (Input, Button, Select...)
    â”œâ”€â”€ layout/ (Header, Sidebar, Footer...)
    â”œâ”€â”€ ui/ (Card, Modal, Alert...)
    â”œâ”€â”€ charts/ (Basic chart components)
    â””â”€â”€ auth/ (Login form, guards...)

State Management:
stores/
    â”œâ”€â”€ auth.js âœ… (Already created)
    â”œâ”€â”€ user.js (Profile, preferences)
    â”œâ”€â”€ client.js (Client settings, team)
    â”œâ”€â”€ admin.js (Admin-specific state)
    â””â”€â”€ subscription.js (Billing, usage)

API Integration:
services/
    â”œâ”€â”€ api.js (Base API with interceptors)
    â”œâ”€â”€ auth.js (Auth endpoints)
    â”œâ”€â”€ user.js (Profile, settings)
    â”œâ”€â”€ client.js (Client management)
    â””â”€â”€ admin.js (Admin endpoints)

https://g.co/gemini/share/6fa3bf1e96a1

https://g.co/gemini/share/48ea4f8d9b7b


Tá»•ng quan Káº¿ hoáº¡ch Triá»ƒn khai: Visual Data Mapper
    Má»¥c tiÃªu cuá»‘i cÃ¹ng: Cho phÃ©p ngÆ°á»i dÃ¹ng khÃ´ng biáº¿t ká»¹ thuáº­t cÃ³ thá»ƒ "dáº¡y" cho LoomSky biáº¿t cÃ¡c máº©u dá»¯ liá»‡u quan trá»ng (tÃªn sáº£n pháº©m, giÃ¡, nÃºt báº¥m...) náº±m á»Ÿ Ä‘Ã¢u trÃªn website cá»§a há» má»™t cÃ¡ch trá»±c quan.
    Thá»i gian dá»± kiáº¿n: 8-14 ngÃ y lÃ m viá»‡c.

Phase 1: Ná»n táº£ng Backend (2-3 ngÃ y)
    Má»¥c tiÃªu: XÃ¢y dá»±ng xÆ°Æ¡ng sá»‘ng API vÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»ƒ lÆ°u trá»¯ vÃ  xÃ¡c thá»±c cáº¥u hÃ¬nh.

CÃ´ng viá»‡c 1.1: XÃ¢y dá»±ng Cáº¥u trÃºc Dá»¯ liá»‡u
    Action: Táº¡o migration vÃ  model Sequelize cho báº£ng DataMappings.
    Schema: id (PK), website_id (FK), variable_name (STRING), selector (TEXT), page_context (STRING, nullable).
    Káº¿t quáº£: Cáº¥u trÃºc database Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c Ã¡nh xáº¡.

CÃ´ng viá»‡c 1.2: XÃ¢y dá»±ng API CRUD cho DataMappings
    Action: Trong websiteController.js vÃ  website.js (routes), táº¡o cÃ¡c endpoint sau, Ä‘áº£m báº£o táº¥t cáº£ Ä‘á»u yÃªu cáº§u xÃ¡c thá»±c vÃ  kiá»ƒm tra quyá»n sá»Ÿ há»¯u website:
        GET /api/v1/websites/{websiteId}/datamaps: Láº¥y danh sÃ¡ch táº¥t cáº£ Ã¡nh xáº¡ cho má»™t website.
        POST /api/v1/websites/{websiteId}/datamaps: Táº¡o má»™t Ã¡nh xáº¡ má»›i.
        DELETE /api/v1/websites/{websiteId}/datamaps/{mapId}: XÃ³a má»™t Ã¡nh xáº¡.
    Káº¿t quáº£: Giao diá»‡n ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘á»c, ghi, vÃ  xÃ³a cÃ¡c cáº¥u hÃ¬nh Ã¡nh xáº¡.  

CÃ´ng viá»‡c 1.3: XÃ¢y dá»±ng API XÃ¡c thá»±c cho "Cháº¿ Ä‘á»™ Thiáº¿t láº­p"
    Action: Táº¡o hai endpoint má»›i trong má»™t file controller/route phÃ¹ há»£p (vÃ­ dá»¥: sdkController.js).
        POST /api/v1/sdk/init-setup: Endpoint nÃ y yÃªu cáº§u xÃ¡c thá»±c user. NÃ³ sáº½ táº¡o má»™t setup_token (JWT hoáº·c UUID dÃ¹ng má»™t láº§n, lÆ°u trong Redis vá»›i TTL 5 phÃºt) vÃ  tráº£ vá» cho frontend.
        POST /api/v1/sdk/verify-setup: Endpoint nÃ y khÃ´ng yÃªu cáº§u xÃ¡c thá»±c user. NÃ³ nháº­n setup_token tá»« SDK, kiá»ƒm tra tÃ­nh há»£p lá»‡ trong Redis, vÃ  náº¿u há»£p lá»‡, tráº£ vá» má»™t "vÃ©" cho phÃ©p SDK tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng.
    Káº¿t quáº£: Má»™t luá»“ng á»§y quyá»n an toÃ n cho phÃ©p SDK kÃ­ch hoáº¡t cÃ¡c tÃ­nh nÄƒng Ä‘áº·c biá»‡t má»™t cÃ¡ch cÃ³ kiá»ƒm soÃ¡t.

CÃ´ng viá»‡c 1.4: Cáº­p nháº­t API Cáº¥u hÃ¬nh SDK
    Action: Sá»­a Ä‘á»•i endpoint GET /api/v1/sdk/config Ä‘á»ƒ nÃ³ eager-load vÃ  tráº£ vá» danh sÃ¡ch cÃ¡c DataMappings thuá»™c vá» website Ä‘Ã³.
    Káº¿t quáº£: SDK khi cháº¡y á»Ÿ cháº¿ Ä‘á»™ bÃ¬nh thÆ°á»ng sáº½ biáº¿t Ä‘Æ°á»£c "Tá»« Ä‘iá»ƒn Dá»¯ liá»‡u" cá»§a website.

Phase 2: Frontend - "TÃ¡c NhÃ¢n Ná»™i Bá»™" (Vue Mini-App) (3-5 ngÃ y)
    Má»¥c tiÃªu: XÃ¢y dá»±ng giao diá»‡n ngÆ°á»i dÃ¹ng trá»±c quan sáº½ Ä‘Æ°á»£c chÃ¨n vÃ o website cá»§a khÃ¡ch hÃ ng.

CÃ´ng viá»‡c 2.1: Thiáº¿t láº­p Build Process
    Action: Cáº¥u hÃ¬nh Vite (hoáº·c Webpack) trong dá»± Ã¡n frontend-customer Ä‘á»ƒ cÃ³ má»™t lá»‡nh build riÃªng (vÃ­ dá»¥: npm run build:mapper). Lá»‡nh nÃ y sáº½ biÃªn dá»‹ch má»™t component Vue cá»¥ thá»ƒ (vÃ­ dá»¥: DataMapper.vue) vÃ  cÃ¡c thÃ nh pháº§n con cá»§a nÃ³ thÃ nh má»™t file mapper.js vÃ  mapper.css duy nháº¥t.
    Káº¿t quáº£: CÃ³ cÃ¡c file tÄ©nh Ä‘á»ƒ SDK cÃ³ thá»ƒ táº£i vá».

CÃ´ng viá»‡c 2.2: XÃ¢y dá»±ng Giao diá»‡n NgÆ°á»i dÃ¹ng (UI)
    Action: PhÃ¡t triá»ƒn cÃ¡c component Vue cho cÃ´ng cá»¥:
        MapperContainer.vue: Component gá»‘c, sáº½ táº¡o ra Shadow DOM.
        Toolbar.vue: Thanh cÃ´ng cá»¥ nhá» hiá»ƒn thá»‹ trÃªn trang (vÃ­ dá»¥: á»Ÿ gÃ³c dÆ°á»›i cÃ¹ng).
        HighlightOverlay.vue: Má»™t component tuyá»‡t Ä‘á»‘i vá»‹ trÃ­ Ä‘á»ƒ váº½ Ä‘Æ°á»ng viá»n xung quanh cÃ¡c pháº§n tá»­.
        MappingModal.vue: Há»™p thoáº¡i hiá»‡n lÃªn sau khi click, chá»©a CSS selector vÃ  dropdown chá»n variable_name.
    Káº¿t quáº£: Má»™t giao diá»‡n ngÆ°á»i dÃ¹ng hoÃ n chá»‰nh, Ä‘Ã³ng gÃ³i vÃ  sáºµn sÃ ng Ä‘á»ƒ Ä‘Æ°á»£c mount.

CÃ´ng viá»‡c 2.3: PhÃ¡t triá»ƒn Logic "Selector"
    Action: Viáº¿t logic cá»‘t lÃµi bÃªn trong cÃ¡c component Vue:
        Gáº¯n cÃ¡c event listener (mouseover, click) vÃ o document cá»§a trang cha (bÃªn ngoÃ i Shadow DOM).
        Viáº¿t hÃ m generateCssSelector(element) Ä‘á»ƒ táº¡o ra má»™t selector Ä‘á»§ tin cáº­y vÃ  duy nháº¥t cho pháº§n tá»­ Ä‘Æ°á»£c click.
        Quáº£n lÃ½ state: pháº§n tá»­ nÃ o Ä‘ang Ä‘Æ°á»£c chá»n, modal cÃ³ Ä‘ang má»Ÿ hay khÃ´ng...
    Káº¿t quáº£: CÃ´ng cá»¥ cÃ³ kháº£ nÄƒng tÆ°Æ¡ng tÃ¡c vá»›i trang cá»§a khÃ¡ch hÃ ng.

Phase 3: SDK - NÃ¢ng cáº¥p "Bá»™ NÃ£o" (2-4 ngÃ y)
    Má»¥c tiÃªu: "Dáº¡y" cho SDK cÃ¡ch kÃ­ch hoáº¡t "Cháº¿ Ä‘á»™ Thiáº¿t láº­p" vÃ  sau Ä‘Ã³ lÃ  cÃ¡ch sá»­ dá»¥ng "Tá»« Ä‘iá»ƒn Dá»¯ liá»‡u".

CÃ´ng viá»‡c 3.1: Triá»ƒn khai Logic KÃ­ch hoáº¡t
    Action: Trong file khá»Ÿi táº¡o cá»§a SDK (core.js hoáº·c index.js):
        ThÃªm logic kiá»ƒm tra window.location.search Ä‘á»ƒ tÃ¬m ls_setup_mode=true.
        Náº¿u tÃ¬m tháº¥y, láº¥y ls_token vÃ  gá»i API POST /api/v1/sdk/verify-setup.
    Káº¿t quáº£: SDK cÃ³ thá»ƒ nháº­n lá»‡nh tá»« á»©ng dá»¥ng LoomSky.

CÃ´ng viá»‡c 3.2: Triá»ƒn khai CÆ¡ cháº¿ "Injection"
    Action: Khi API verify-setup tráº£ vá» thÃ nh cÃ´ng, SDK sáº½:
        Táº¡o Ä‘á»™ng má»™t tháº» <link rel="stylesheet"> Ä‘á»ƒ táº£i file mapper.css.
        Táº¡o Ä‘á»™ng má»™t tháº» <script> Ä‘á»ƒ táº£i file mapper.js.
        Sau khi script Ä‘Æ°á»£c táº£i, gá»i hÃ m mountDataMapperApp() Ä‘Æ°á»£c export tá»« script Ä‘Ã³ Ä‘á»ƒ khá»Ÿi cháº¡y á»©ng dá»¥ng Vue bÃªn trong Shadow DOM.
    Káº¿t quáº£: SDK cÃ³ kháº£ nÄƒng "chÃ¨n" vÃ  khá»Ÿi cháº¡y cÃ´ng cá»¥ Visual Mapper.

CÃ´ng viá»‡c 3.3: NÃ¢ng cáº¥p "Engine Thu tháº­p Dá»¯ liá»‡u"
    Action: Trong luá»“ng hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng (khÃ´ng pháº£i setup mode), SDK sáº½:
        Láº¥y danh sÃ¡ch DataMappings tá»« API /sdk/config.
        Khi trang táº£i xong, nÃ³ sáº½ duyá»‡t qua danh sÃ¡ch nÃ y, dÃ¹ng document.querySelector vá»›i cÃ¡c selector Ä‘Ã£ lÆ°u Ä‘á»ƒ tÃ¬m cÃ¡c pháº§n tá»­ tÆ°Æ¡ng á»©ng.
        Láº¥y ná»™i dung (innerText, value...) cá»§a cÃ¡c pháº§n tá»­ tÃ¬m tháº¥y vÃ  lÆ°u vÃ o má»™t Ä‘á»‘i tÆ°á»£ng dá»¯ liá»‡u ná»™i bá»™, sáºµn sÃ ng cho cÃ¡c "TrÃ¬nh KÃ­ch hoáº¡t" sá»­ dá»¥ng.
    Káº¿t quáº£: SDK giá» Ä‘Ã¢y cÃ³ kháº£ nÄƒng "Ä‘á»c hiá»ƒu" website cá»§a khÃ¡ch hÃ ng.

Phase 4: TÃ­ch há»£p & HoÃ n thiá»‡n (1-2 ngÃ y)
    Má»¥c tiÃªu: Káº¿t ná»‘i táº¥t cáº£ cÃ¡c thÃ nh pháº§n láº¡i vá»›i nhau vÃ  Ä‘áº£m báº£o luá»“ng hoáº¡t Ä‘á»™ng mÆ°á»£t mÃ .

CÃ´ng viá»‡c 4.1: Káº¿t ná»‘i Frontend vÃ  Backend
    Action: Trong frontend-customer, trang WebsiteDetailView.vue, triá»ƒn khai logic cho nÃºt "Thiáº¿t láº­p Ãnh xáº¡ Dá»¯ liá»‡u": gá»i API init-setup vÃ  window.open vá»›i URL Ä‘Ã£ Ä‘á»‹nh dáº¡ng.
    Action: Trong á»©ng dá»¥ng Vue mini, logic cá»§a nÃºt "LÆ°u" trong modal sáº½ gá»i trá»±c tiáº¿p Ä‘áº¿n API POST /api/v1/websites/{websiteId}/datamaps.
    Action: Triá»ƒn khai giao diá»‡n hiá»ƒn thá»‹ danh sÃ¡ch cÃ¡c Ã¡nh xáº¡ Ä‘Ã£ lÆ°u vÃ  nÃºt xÃ³a tÆ°Æ¡ng á»©ng.

CÃ´ng viá»‡c 4.2: Kiá»ƒm thá»­ ToÃ n diá»‡n (E2E)
    Action: Thá»±c hiá»‡n kiá»ƒm thá»­ trÃªn nhiá»u loáº¡i website khÃ¡c nhau (WordPress, HTML Ä‘Æ¡n giáº£n, trang cÃ³ cáº¥u trÃºc phá»©c táº¡p) Ä‘á»ƒ Ä‘áº£m báº£o:
        Luá»“ng kÃ­ch hoáº¡t hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh.
        Viá»‡c highlight vÃ  chá»n pháº§n tá»­ chÃ­nh xÃ¡c.
        CSS selector Ä‘Æ°á»£c táº¡o ra lÃ  Ä‘Ã¡ng tin cáº­y.
        Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u vÃ  táº£i láº¡i chÃ­nh xÃ¡c.
    Káº¿t quáº£ cuá»‘i cÃ¹ng: Má»™t tÃ­nh nÄƒng hoÃ n chá»‰nh, máº¡nh máº½ vÃ  sáºµn sÃ ng Ä‘á»ƒ ngÆ°á»i dÃ¹ng tráº£i nghiá»‡m.